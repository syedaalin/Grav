{% macro responsive_image(image, alt, sizes, loading) %}
{#
    Responsive Image Macro for 2026 Standards
    
    Generates optimized <picture> element with WebP/AVIF support,
    lazy loading, and proper dimensions for CLS prevention
    
    Usage:
    {% import 'macros/image.html.twig' as img %}
    {{ img.responsive_image(page.media['hero.jpg'], 'Hero Image', '(max-width: 768px) 100vw, 50vw', 'lazy') }}
#}
{% set sizes = sizes|default('100vw') %}
{% set loading = loading|default('lazy') %}
{% set alt_text = alt|default('') %}

{% if image %}
<picture>
    {# Modern formats: AVIF (best compression) #}
    {% if image.format('avif') %}
    <source 
        type="image/avif" 
        srcset="{{ image.derivatives(320, 640, 960, 1280, 1920).avif.srcset }}"
        sizes="{{ sizes }}"
    >
    {% endif %}
    
    {# WebP (good compression, wider support) #}
    {% if image.format('webp') %}
    <source 
        type="image/webp" 
        srcset="{{ image.derivatives(320, 640, 960, 1280, 1920).webp.srcset }}"
        sizes="{{ sizes }}"
    >
    {% endif %}
    
    {# Fallback: Original format with srcset #}
    <img 
        src="{{ image.url }}" 
        srcset="{{ image.derivatives(320, 640, 960, 1280, 1920).srcset }}" 
        sizes="{{ sizes }}"
        alt="{{ alt_text|e('html') }}"
        width="{{ image.width }}"
        height="{{ image.height }}"
        loading="{{ loading }}"
        decoding="async"
        {% if loading == 'eager' or loading == 'auto' %}
        fetchpriority="high"
        {% endif %}
    >
</picture>
{% endif %}
{% endmacro %}

{% macro simple_image(image, alt, loading, class) %}
{#
    Simple Optimized Image (single source with lazy loading)
    
    Usage:
    {% import 'macros/image.html.twig' as img %}
    {{ img.simple_image(page.media['photo.jpg'], 'Photo', 'lazy', 'rounded') }}
#}
{% set loading = loading|default('lazy') %}
{% set class = class|default('')  %}
{% set alt_text = alt|default('') %}

{% if image %}
<img 
    src="{{ image.url }}" 
    alt="{{ alt_text|e('html') }}"
    width="{{ image.width }}"
    height="{{ image.height }}"
    loading="{{ loading }}"
    decoding="async"
    {% if class %}class="{{ class }}"{% endif %}
    {% if loading == 'eager' %}fetchpriority="high"{% endif %}
>
{% endif %}
{% endmacro %}
