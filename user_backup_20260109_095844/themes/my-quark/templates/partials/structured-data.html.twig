{# JSON-LD Structured Data for SEO (2026 Standards) #}

{# ==========================================================================
   SCHEMA 1: WebSite + Sitelinks Search Box
   ========================================================================== #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "{{ site.title|e('html') }}",
  "url": "{{ uri.rootUrl(true) }}",
  {% set site_description = site.metadata.description %}
  {% if site_description is iterable %}
    {% set site_description = site_description|first %}
  {% endif %}
  {% if site_description %}
  "description": "{{ site_description|e('html') }}",
  {% endif %}
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "{{ uri.rootUrl(true) }}/search?query={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  },
  "inLanguage": "{{ grav.language.getActive ?: 'en' }}"
}
</script>

{# ==========================================================================
   SCHEMA 2: Organization (Enhanced with Social Profiles)
   ========================================================================== #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{{ page.template == 'courses' ? 'EducationalOrganization' : 'Organization' }}",
  "name": "{{ site.title|e('html') }}",
  {% set site_desc = site.metadata.description|default('Professional web development and digital services') %}\n  "description": "{{ (site_desc|iterable ? site_desc|join(' ') : site_desc)|e('html') }}",
  "url": "{{ uri.rootUrl(true) }}",
  {% set logo_var = theme_var('agent_identity_logo')|default(theme_var('logo')) %}
  {% set logo_filename = null %}
  
  {% if logo_var|iterable %}
      {% set first_item = logo_var|first %}
      {% if first_item.name is defined %}
          {% set logo_filename = first_item.name %}
      {% endif %}
  {% endif %}

  {% if logo_filename %}
  "logo": {
    "@type": "ImageObject",
    "url": "{{ url('theme://images/logo/' ~ logo_filename, true) }}",
    "width": "{{ theme_var('logo_height')|default(48) }}",
    "height": "{{ theme_var('logo_height')|default(48) }}"
  },
  "image": "{{ url('theme://images/logo/' ~ logo_filename, true) }}",
  {% endif %}
  {% set contact_email = theme_var('agent_identity_email')|default(theme_var('contact_email')) %}
  {% set contact_phone = theme_var('agent_identity_phone')|default(theme_var('contact_phone')) %}
  {% if contact_phone or contact_email %}
  "contactPoint": {
    "@type": "ContactPoint",
    {% if contact_phone %}
    "telephone": "{{ (contact_phone|iterable ? contact_phone|join(', ') : contact_phone)|e('html') }}",
    {% endif %}
    {% if contact_email %}
    "email": "{{ (contact_email|iterable ? contact_email|join(', ') : contact_email)|e('html') }}",
    {% endif %}
    "contactType": "Customer Service",
    "availableLanguage": ["{{ grav.language.getActive ?: 'en' }}"]
  },
  {% endif %}
  {% set contact_address = theme_var('agent_identity_address')|default(theme_var('contact_address')) %}
  {% if contact_address %}
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "{{ (contact_address|iterable ? contact_address|join(' ') : contact_address)|e('html') }}"
  },
  {% endif %}
  "sameAs": [
    {% set social = theme_var('agent_identity_social')|default(theme_var('social_links')) %}
    {% if social %}
      {% for item in social %}
        "{{ item.url }}"{% if not loop.last %},{% endif %}
      {% endfor %}
    {% endif %}
  ]
}
</script>

{# ==========================================================================
   SCHEMA 3: BreadcrumbList (Site Navigation)
   ========================================================================== #}
{% if page.route != '/' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ uri.rootUrl(true) }}"
    }
    {% set breadcrumbs = [] %}
    {% set current = page %}
    {% for i in range(0, 10) %}
      {% if current.parent and current.parent.routable %}
        {% set breadcrumbs = [current.parent] | merge(breadcrumbs) %}
        {% set current = current.parent %}
      {% endif %}
    {% endfor %}
    {% for crumb in breadcrumbs %}
    ,{
      "@type": "ListItem",
      "position": {{ loop.index + 1 }},
      "name": "{{ crumb.menu|default(crumb.title)|e('html') }}",
      "item": "{{ crumb.url(true) }}"
    }
    {% endfor %}
    ,{
      "@type": "ListItem",
      "position": {{ breadcrumbs|length + 2 }},
      "name": "{{ page.menu|default(page.title)|e('html') }}",
      "item": "{{ page.url(true) }}"
    }
  ]
}
</script>
{% endif %}

{% if page.template == 'courses' %}
{# Course Listing Schema #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "{{ page.title|e('html') }}",
  "description": "{{ page.metadata.description|e('html') }}",
  "itemListElement": [
    {% set courses = page.children %}
    {% for course in courses %}
    {
      "@type": "Course",
      "name": "{{ course.title|e('html') }}",
      "description": "{{ course.header.short_description|e('html') }}",
      "provider": {
        "@type": "Organization",
        "name": "{{ site.title|e('html') }}"
      }{% if course.header.instructor %},
      {% set instructor = course.header.instructor %}
      "instructor": {
        "@type": "Person",
        "name": "{{ (instructor|iterable ? instructor|join(', ') : instructor)|e('html') }}"
      }{% endif %}{% if course.header.duration %},
      {% set duration = course.header.duration %}
      "timeRequired": "{{ (duration|iterable ? duration|join(' ') : duration)|e('html') }}"{% endif %}
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>
{% endif %}

{% if page.header.instructor %}
{# Individual Course Schema #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Course",
  "name": "{{ page.title|e('html') }}",
  "description": "{{ page.header.short_description|e('html') }}",
  "provider": {
    "@type": "Organization",
    "name": "{{ site.title|e('html') }}",
    "url": "{{ uri.rootUrl(true) }}"
  },
  "instructor": {
    "@type": "Person",
    {% set page_instructor = page.header.instructor %}
    "name": "{{ (page_instructor|iterable ? page_instructor|join(', ') : page_instructor)|e('html') }}"
  }{% if page.header.duration %},
  {% set page_duration = page.header.duration %}
  "timeRequired": "{{ (page_duration|iterable ? page_duration|join(' ') : page_duration)|e('html') }}"{% endif %}{% if page.header.level %},
  "educationalLevel": "{{ page.header.level|e('html') }}"{% endif %},
  "inLanguage": "en",
  "courseMode": "online",
  "availableLanguage": ["English", "Urdu"]
}
</script>
{% endif %}

{# ==========================================================================
   SCHEMA 4: Article / BlogPosting (for blog posts and articles)
   ========================================================================== #}
{% if page.taxonomy.tag or page.taxonomy.category or page.header.author %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{{ page.taxonomy.category ? 'BlogPosting' : 'Article' }}",
  "headline": "{{ page.title|e('html') }}",
  "name": "{{ page.title|e('html') }}",
  {% if page.summary %}
  "description": "{{ page.summary(200)|striptags|e('html') }}",
  {% elseif site.metadata.description %}
  "description": "{{ site.metadata.description|e('html') }}",
  {% endif %}
  "url": "{{ page.url(true) }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ page.url(true) }}"
  },
  {% if page.media.images|first %}
  "image": {
    "@type": "ImageObject",
    "url": "{{ page.media.images|first.url(true) }}",
    "width": "{{ page.media.images|first.width|default(1200) }}",
    "height": "{{ page.media.images|first.height|default(630) }}"
  },
  {% endif %}
  "datePublished": "{{ page.date|date('c') }}",
  "dateModified": "{{ page.modified|default(page.date)|date('c') }}",
  "author": {
    "@type": "Person",
    "name": "{{ page.header.author|default(site.author.name)|default(site.title)|e('html') }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ site.title|e('html') }}",
    "url": "{{ uri.rootUrl(true) }}"
    {% if logo_filename %},
    "logo": {
      "@type": "ImageObject",
      "url": "{{ url('theme://images/logo/' ~ logo_filename, true) }}"
    }
    {% endif %}
  },
  {% if page.taxonomy.tag %}
  "keywords": "{{ page.taxonomy.tag|join(', ')|e('html') }}",
  {% endif %}
  "inLanguage": "{{ page.header.language|default(grav.language.getActive)|default('en') }}"
}
</script>
{% endif %}

