@layer layout {
  /* ========================================
     Container System
     ======================================== */
  
  .container {
    width: 100%;
    max-width: 80rem; /* 1280px */
    margin-inline: auto;
  }
  
  .section-container {
    width: 100%;
    max-width: 80rem;
    margin-inline: auto;
    padding-inline: clamp(1rem, 5vw, 2rem);
    container-type: inline-size;
  }
  
  .section-container-narrow {
    width: 100%;
    max-width: 56rem; /* 4xl */
    margin-inline: auto;
    padding-inline: clamp(1rem, 5vw, 2rem);
    container-type: inline-size;
  }
  
  .container-px {
    padding-inline: clamp(1rem, 5vw, 2rem);
  }
  
  .section-py {
    padding-block: var(--spacing-section);
  }
  
  /* ========================================
     Grid Systems
     ======================================== */
  
  .grid-bento {
    display: grid;
    grid-template-columns: repeat(1, minmax(0, 1fr));
    gap: 2rem;
    
    @container (width >= 768px) {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    
    @container (width >= 1280px) {
      grid-template-columns: repeat(4, minmax(0, 1fr));
    }
  }
  
  .grid-gallery {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 1.5rem;
    
    @container (width >= 768px) {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    
    @container (width >= 1024px) {
      grid-template-columns: repeat(4, minmax(0, 1fr));
    }
  }
  
  /* ========================================
     Stack Pattern (Vertical Spacing)
     ======================================== */
  
  .stack > * + * {
    margin-top: var(--space-m);
  }
  
  .stack-s > * + * {
    margin-top: var(--space-s);
  }
  
  .stack-l > * + * {
    margin-top: var(--space-l);
  }
  
  /* ========================================
     Flex Utilities
     ======================================== */
  
  .flex-center {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .flex-between {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  /* ========================================
     Layout Components
     ======================================== */

  @scope (.layout-grid) {
    :scope {
      display: grid;
      gap: 3rem;
      grid-template-columns: 100%;
      
      &.has-sidebar {
           @container (width >= 1024px) {
                grid-template-columns: 1fr 20rem; 
           }
      }

      /* Intrinsic Responsive Columns */
      @container (width >= 1024px) {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }

      @container (width >= 1280px) {
        gap: 4rem;
      }
    }
  }
  
  .layout-sidebar {
      /* Placeholder for specific sidebar styling if needed */
  }
  
  .sticky-sidebar {
      position: sticky;
      inset-block-start: 6rem; /* top-24 */
      z-index: 10;
  }

  /* Scoped Column Spanning */
  @scope (.layout-sidebar-col) {
    :scope {
      grid-column: span 1 / span 1;
      
      .layout-grid:scope > & {
         @container (width >= 1024px) {
             grid-column: span 3 / span 3;
         }
      }
    }
  }

  .container-inline {
    container-type: inline-size;
  }
  
  .flex-width-full {
    display: flex;
    align-items: center;
    width: 100%;
  }
  /* ========================================
     Header System
     ======================================== */

  /* Base Header Layout (Glassmorphism) */
  @scope (.header-main-sticky) {
    :scope {
      position: relative;
      z-index: 9999; /* Below top banner but above page content */
      
      /* Glassmorphism Core */
      background: var(--glass-surface);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      border-block-end: var(--glass-border);
      box-shadow: var(--glass-shadow);
      
      color: var(--color-text);
      padding-block: var(--header-padding);
      transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
      width: 100%;
      will-change: transform, background-color, padding;
    }
  }

  /* 1. Fixed Header Logic */
  body.header-fixed .header-main-sticky {
    position: sticky;
    inset-block-start: var(--header-top-offset, 0);
  }

  /* 2. Animated Header Logic (Shrink on scroll) */
  body.header-animated .header-main-sticky {
    padding-block: var(--header-padding);
  }

  body.header-animated .header-main-sticky.is-scrolled {
    padding-block: calc(var(--header-padding) * 0.6);
    /* Increase blur/opacity slightly on scroll for readability */
    backdrop-filter: blur(calc(var(--glass-blur) * 1.5));
    -webkit-backdrop-filter: blur(calc(var(--glass-blur) * 1.5));
    background: linear-gradient(135deg, oklch(1 0 0 / 0.8), oklch(1 0 0 / 0.6));
  }

  /* 3. Dark Header Logic (Dark Glass) */
  body.header-dark .header-main-sticky {
    background: linear-gradient(135deg, oklch(0.1 0 0 / 0.7), oklch(0.1 0 0 / 0.5));
    border-block-end: 1px solid oklch(1 1 1 / 0.05);
    color: white;
  }
  
  body.header-dark .header-main-sticky .nav-link {
    color: rgba(255, 255, 255, 0.9);
  }

  body.header-dark .header-main-sticky .nav-link:hover,
  body.header-dark .header-main-sticky .nav-link.active {
    color: var(--color-primary);
  }

  /* 4. Transparent Header Logic */
  body.header-transparent .header-main-sticky {
    background: transparent;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border-block-end: none;
    box-shadow: none;
    position: absolute;
    inset-block-start: var(--header-top-offset, 0); 
  }

  /* Transparent + Scrolled = Glass Header */
  body.header-transparent .header-main-sticky.is-scrolled {
    background: var(--glass-surface);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border-block-end: var(--glass-border);
    box-shadow: var(--glass-shadow);
    color: var(--color-text);
    position: sticky;
  }

  /* Transparent + Dark (Initial State) */
  body.header-transparent.header-dark .header-main-sticky:not(.is-scrolled) {
    background: transparent;
    color: white;
  }

  /* Transparent + Dark + Scrolled = Dark Glass */
  body.header-transparent.header-dark .header-main-sticky.is-scrolled {
     background: linear-gradient(135deg, oklch(0.1 0 0 / 0.7), oklch(0.1 0 0 / 0.5));
     border-block-end: 1px solid oklch(1 0 0 / 0.1);
     color: white;
  }

  /* ========================================
     Sticky Header Wrapper Logic
     ======================================== */
  .header-top-sticky {
      position: sticky;
      top: 0;
      z-index: 10000; /* Highest priority */
      width: 100%;
      display: block !important;
  }

  .header-main-sticky {
      position: sticky;
      top: var(--header-top-offset, 0px);
      z-index: 9999;
      width: 100%;
      transition: all 400ms var(--transition-standard);
  }

  /* ========================================
     Top Banner System
     ======================================== */

  /* Robust Top Banner Styles (Centralized) */
  .top-banner {
      width: 100%;
      z-index: 10000;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      border-block-end: 1px solid oklch(1 0 0 / 0.15);
      min-height: 2.75rem; 
      background-color: oklch(0.15 0.05 260); /* Resilient fallback */
      color: white;
  }

  .top-banner-inner {
    max-width: 80rem;
    margin-inline: auto;
    padding-inline: clamp(1rem, 5vw, 2rem);
    min-height: 2.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

    .top-banner-layout {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;

      @media (max-width: 768px) {
        padding-block: 0.625rem;
      }
    }

    /* 1. Exclusive Announcement Mode */
    .top-banner-announcement {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .announcement-marquee-container {
      overflow: hidden;
      width: 100%;
      display: flex;
      justify-content: center;
    }

    .announcement-marquee {
      white-space: nowrap;
      padding-inline: 2rem;
      animation: announcement-fade 500ms ease-out forwards;
    }

    /* 2. Widgets Area (Radiant Trio) */
    .top-banner-widgets {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.25rem;
      width: 100%;
      
      @media (max-width: 768px) {
        gap: 0.625rem;
        flex-wrap: wrap;
      }
    }

    .banner-pill {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      padding: 0.4375rem 1rem;
      background: oklch(1 0 0 / 0.05);
      border: 1px solid oklch(1 0 0 / 0.1);
      border-radius: var(--radius-full);
      backdrop-filter: blur(8px);
      transition: all 400ms var(--transition-standard);
      white-space: nowrap;
      opacity: 1; /* Initial state visible */
      animation: banner-entry 600ms cubic-bezier(0.2, 0.8, 0.2, 1) both;
      
      &:nth-child(1) { animation-delay: 100ms; }
      &:nth-child(2) { animation-delay: 250ms; }
      &:nth-child(3) { animation-delay: 400ms; }
      
      &:hover {
        background: oklch(1 0 0 / 0.1);
        border-color: oklch(from var(--color-primary) l c h / 0.4);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px -4px oklch(0 0 0 / 0.3);
      }
    }

    .pill-icon {
      width: 0.9375rem;
      height: 0.9375rem;
      color: var(--color-primary);
      flex-shrink: 0;
      opacity: 0.9;
    }

    .banner-prayer-name {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 700;
      font-size: 0.75rem;
      opacity: 0.8;
      margin-inline-end: 0.25rem;
    }

    .banner-countdown {
      font-variant-numeric: tabular-nums;
      font-weight: 700;
      color: var(--color-primary);
    }

    .banner-date {
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .year-responsive {
      opacity: 0.5;
      @media (max-width: 1024px) {
        display: none;
      }
    }

    @keyframes banner-entry {
      from { 
        opacity: 0; 
        transform: translateY(-10px) scale(0.98); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
      }
    }

    @keyframes announcement-fade {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
  }
  }

  /* ========================================
     Bottom Banner Modular System
     ======================================== */

  @scope (.bottom-banner-main) {
  }

  /* ========================================
     Social Connectivity System (Shared)
     ======================================== */

  .social-icons-wrapper.is-top {
      display: flex;
      gap: 0.75rem;
      align-items: center;

      .social-icon {
          background: transparent;
          width: auto;
          height: auto;
          backdrop-filter: none;
          padding: 0;
          color: inherit !important;
          
          &:hover {
              transform: translateY(-2px);
              box-shadow: none;
              color: var(--color-primary) !important;
          }

          svg {
              width: 1rem;
              height: 1rem;
          }
      }
  }

  .social-icons-wrapper.is-bottom {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;

      @media (min-width: 768px) {
          justify-content: flex-start;
      }

      .social-icon {
          position: relative;
          display: flex;
          align-items: center;
          justify-content: center;
          width: 3.5rem;
          height: 3.5rem;
          border-radius: var(--radius-full);
          background-color: oklch(1 0 0 / 0.1);
          backdrop-filter: blur(8px);
          transition: all 300ms ease;

          &:hover {
              background-color: var(--color-primary);
              transform: scale(1.1);
              box-shadow: 0 10px 20px oklch(from var(--color-primary) l c h / 0.2);
          }

          svg {
              width: 1.5rem;
              height: 1.5rem;
          }
      }
  }

  @scope (.bottom-banner-main) {
    .bottom-banner-layout-stack {
      display: flex;
      flex-direction: column;
    }

    /* Newsletter Strip */
    .bottom-banner-newsletter {
      padding-block: var(--space-xl);
      background-color: oklch(from var(--color-primary) l c h / 0.1);
      border-block: 1px solid oklch(from var(--color-primary) l c h / 0.1);
      
      .newsletter-container {
        max-width: 80rem;
        margin-inline: auto;
        padding-inline: clamp(1rem, 5vw, 2rem);
        display: grid;
        grid-template-columns: 1fr 1.5fr;
        align-items: center;
        gap: 2rem;

        @media (max-width: 768px) {
          grid-template-columns: 1fr;
          text-align: center;
        }
      }

      .newsletter-title {
        font-family: var(--font-heading);
        font-size: 1.5rem;
        font-weight: 800;
        margin-block-end: 0.5rem;
        color: white;
      }

      .newsletter-description {
        opacity: 0.8;
      }

      .newsletter-form {
        .input-group {
          display: flex;
          background: oklch(1 0 0 / 0.1);
          padding: 0.5rem;
          border-radius: var(--radius-full);
          border: 1px solid oklch(1 0 0 / 0.2);
          transition: all 300ms ease;
          
          &:focus-within {
            background: oklch(1 0 0 / 0.15);
            border-color: var(--color-primary);
            box-shadow: 0 0 0 4px oklch(from var(--color-primary) l c h / 0.2);
          }
        }

        .newsletter-input {
          flex: 1;
          background: transparent;
          border: none;
          padding-inline: 1rem;
          color: white;
          font-family: var(--font-body);
          
          &::placeholder {
            color: oklch(1 0 0 / 0.5);
          }
          
          &:focus {
            outline: none;
          }
        }

        .newsletter-submit {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          background: var(--color-primary);
          color: white;
          border: none;
          padding: 0.75rem 1.5rem;
          border-radius: var(--radius-full);
          font-weight: 700;
          cursor: pointer;
          transition: all 300ms ease;
          
          &:hover {
            transform: translateX(2px);
            filter: brightness(1.1);
          }
        }
      }
    }

    /* Social Strip Styling */
    .bottom-banner-social-strip {
        padding-block: var(--space-m);
        border-block-end: 1px solid oklch(from var(--color-bottom-banner-text) l c h / 0.1);
    }
  }
}
