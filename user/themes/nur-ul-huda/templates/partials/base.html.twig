{% set direction = theme_var('direction')|default('ltr') %}
{% set language = theme_var('language')|default(grav.language.getActive ?: grav.config.site.default_lang ?: 'en') %}
{% set typography = theme_var('typography')|default('font-sans') %}
{% set body_classes = body_class(['header-fixed', 'header-animated', 'header-dark', 'header-transparent', direction, typography]) %}
{% set grid_size = theme_var('grid-size') %}
{% set compress = theme_var('production-mode') ? '.min.css' : '.css' %}
{% set top_banner_color = theme_var('top_banner_bg_color') %}



<!DOCTYPE html>
<html lang="{{ language }}" dir="{{ direction }}" style="{% if top_banner_color %}--top-banner-color: {{ top_banner_color }};{% endif %} {{ dynamic_styles|raw }}; --font-heading: {{ theme_fonts.heading|raw }}; --font-body: {{ theme_fonts.body|raw }};">
	<head>
		{% if theme_fonts.custom_css %}
			<style>
				{{theme_fonts.custom_css|raw}}</style>
		{% endif %}
		{# Critical CSS (Inlined) - Using asset system instead of source() #}
		{% do assets.addInlineCss(read_file('theme://css/layers/tokens.css'), {'priority': 100}) %}
		{% do assets.addInlineCss(read_file('theme://css/layers/reset.css'), {'priority': 99}) %}
		{{ assets.css()|raw }}

		{# Local Fonts #}
		{% block head deferred %}
			{% include 'partials/head.html.twig' %}
		{% endblock head %}

		{% block stylesheets %}
			{% if theme_var('production-mode') %}
				{% do assets.addCss('theme://css/nur-ul-huda.css') %}
			{% else %}
				{% do assets.addCss('theme://css/modern-vanilla.css') %}
			{% endif %}
			{% do assets.addCss('theme://css/line-awesome.min.css') %}
		{% endblock %}

		{% block javascripts %}
			{# Core ES Modules #}
			{% do assets.addJs('theme://js/modules/khums-calculator.js', {'priority': 100, 'group': 'bottom', 'type': 'module'}) %}
			{% do assets.addJs('theme://js/modules/ui.js', {'priority': 95, 'group': 'bottom', 'type': 'module'}) %}


			{# Performance & Features #}
			{% do assets.addJs('theme://js/modules/performance-monitor.js', {'priority': 94, 'group': 'bottom', 'type': 'module'}) %}
			{% do assets.addJs('theme://js/modules/pull-refresh.js', {'priority': 94, 'group': 'bottom', 'type': 'module'}) %}
			{% do assets.addJs('theme://js/modules/gallery.js', {'priority': 93, 'group': 'bottom', 'type': 'module'}) %}

			{# Accessibility #}
			{% do assets.addJs('theme://js/modules/high-contrast.js', {'priority': 89, 'group': 'bottom', 'type': 'module'}) %}
			{% do assets.addJs('theme://js/modules/font-scaler.js', {'priority': 89, 'group': 'bottom', 'type': 'module'}) %}

			{# Layout Logic #}
			{% do assets.addJs('theme://js/modules/bottom-banner.js', {'priority': 89, 'group': 'bottom', 'type': 'module'}) %}

			{# Spiritual Logic REMOVED per user request (Top Banner widgets gone) #}

			{# Service Worker #}
		{% do assets.addJs('theme://js/modules/service-worker.js', {'priority': 87, 'group': 'bottom', 'type': 'module'}) %}
		{% endblock %}

			{% block assets deferred %}
			{{ assets.css()|raw }}
		{{ assets.js()|raw }}
	{% endblock %}
	</head>
		<body id="top" class="{{ body_classes }} {{ dynamic_body_classes|join(' ') }}"> <div
			id="page-wrapper">
			{# Skip Link for Accessibility #}
			<a href="#start" class="skip-link">Skip to main content</a>


			{# 
															               --- HEADER SECTION START --- 
															               Blueprint: [ui-utilities.blueprint.md](blueprints/docs/ui-utilities.blueprint.md)
															            #}
			{% block header %}
				{% include 'partials/header-wrapper.html.twig' %}
				{# Left Sidebar: Services #}
				{% include 'partials/sidebar-left.html.twig' %}
				{# Right Sidebar: Global Navigation #}
				{% include 'partials/sidebar-right.html.twig' %}
			{% endblock %}


			{% block hero %}{% endblock %}

			<section id="start">
				{% block body %}
					<main id="body-wrapper" class="section-py container-px">
						{% block messages %}
							<div class="container message-spacer">
								{% include 'partials/messages.html.twig' ignore missing %}
							</div>
						{% endblock %}
						<div class="container">
							{% block content %}{% endblock %}
						</div>
					</main>
				{% endblock %}
			</section>

			{% block footer %}
				{% include 'partials/bottom-banner/main.html.twig' %}
			{% endblock %}

			{% include 'partials/search-overlay.html.twig' %}
		</div>

		{% block bottom %}
			{{ assets.js('bottom')|raw }}
			{% include 'partials/snipcart.html.twig' %}

			{# Pass theme config to JavaScript #}
			<script>
				window.GravConfig = {{ theme_js_config|default({})|merge({'theme_url': theme_url})|json_encode|raw }};
			</script>
		{% endblock %}
	</body>
</html>
