{# Footer Template - Enhanced with 2026 Best Practices #}
{% set footer_columns = theme_var('footer_columns') %}
{% set show_social = theme_var('footer_show_social')|default(true) %}
{% set copyright = theme_var('footer_copyright') %}
{% set site_name = theme_var('site_name')|default(site.title) %}
{% set direction = theme_var('direction')|default('ltr') %}
{% set total_columns = 1 + (footer_columns ? footer_columns|length : 0) %}
{% set has_contact = theme_var('contact_phone') or theme_var('contact_address') or theme_var('social_email') %}

{# Macro for Social Media Icons (DRY Principle) #}
{% macro social_icon(url, platform, icon_class, label) %}
    <a href="{{ url }}" 
       target="_blank" 
       rel="noopener noreferrer" 
       class="footer-social-icon group"
       aria-label="{{ label }}">
        <i class="{{ icon_class }}" aria-hidden="true"></i>
    </a>
{% endmacro %}

<footer id="footer" class="footer" role="contentinfo" aria-label="Site footer">
    {# Schema.org JSON-LD Structured Data for SEO #}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "{{ site_name|e('js') }}",
        "url": "{{ url('', [], true) }}",
        {% if theme_var('custom_logo') %}
        "logo": "{{ url(theme_var('custom_logo'), [], true) }}",
        {% endif %}
        {% if theme_var('social_email') or theme_var('contact_phone') %}
        "contactPoint": {
            "@type": "ContactPoint",
            {% if theme_var('contact_phone') %}"telephone": "{{ theme_var('contact_phone')|e('js') }}",{% endif %}
            {% if theme_var('social_email') %}"email": "{{ theme_var('social_email')|e('js') }}",{% endif %}
            "contactType": "customer service"
        },
        {% endif %}
        {% if theme_var('contact_address') %}
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "{{ theme_var('contact_address')|e('js')|replace({'\n': ', '}) }}"
        },
        {% endif %}
        "sameAs": [
            {% if theme_var('social_facebook') %}"{{ theme_var('social_facebook')|e('js') }}",{% endif %}
            {% if theme_var('social_twitter') %}"{{ theme_var('social_twitter')|e('js') }}",{% endif %}
            {% if theme_var('social_instagram') %}"{{ theme_var('social_instagram')|e('js') }}",{% endif %}
            {% if theme_var('social_youtube') %}"{{ theme_var('social_youtube')|e('js') }}",{% endif %}
            {% if theme_var('social_telegram') %}"{{ theme_var('social_telegram')|e('js') }}",{% endif %}
            {% if theme_var('social_whatsapp') %}"{{ theme_var('social_whatsapp')|e('js') }}"{% endif %}
        ]
    }
    </script>

    {# Decorative Background Pattern #}
    <div class="footer-pattern" aria-hidden="true">
        <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <pattern id="footer-pattern" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
                    <circle cx="20" cy="20" r="1" fill="currentColor"/>
                </pattern>
            </defs>
            <rect width="100%" height="100%" fill="url(#footer-pattern)"/>
        </svg>
    </div>

    {# Main Footer Content #}
    <div class="footer-main">
        
        {# Social Media Section - Priority Content #}
        {% if show_social and (theme_var('social_facebook') or theme_var('social_twitter') or theme_var('social_instagram') or theme_var('social_youtube') or theme_var('social_telegram') or theme_var('social_whatsapp')) %}
            <section class="footer-social" aria-labelledby="footer-social-heading">
                <h2 id="footer-social-heading" class="footer-social-title">
                    Connect With Us
                </h2>
                <div class="footer-social-icons">
                    {% if theme_var('social_facebook') %}
                        {{ _self.social_icon(theme_var('social_facebook'), 'facebook', 'lab la-facebook-f', 'Visit our Facebook page') }}
                    {% endif %}
                    {% if theme_var('social_twitter') %}
                        {{ _self.social_icon(theme_var('social_twitter'), 'twitter', 'lab la-twitter', 'Follow us on Twitter') }}
                    {% endif %}
                    {% if theme_var('social_instagram') %}
                        {{ _self.social_icon(theme_var('social_instagram'), 'instagram', 'lab la-instagram', 'Follow us on Instagram') }}
                    {% endif %}
                    {% if theme_var('social_youtube') %}
                        {{ _self.social_icon(theme_var('social_youtube'), 'youtube', 'lab la-youtube', 'Subscribe to our YouTube channel') }}
                    {% endif %}
                    {% if theme_var('social_telegram') %}
                        {{ _self.social_icon(theme_var('social_telegram'), 'telegram', 'lab la-telegram', 'Join our Telegram group') }}
                    {% endif %}
                    {% if theme_var('social_whatsapp') %}
                        {{ _self.social_icon(theme_var('social_whatsapp'), 'whatsapp', 'lab la-whatsapp', 'Contact us on WhatsApp') }}
                    {% endif %}
                </div>
            </section>
        {% endif %}

        {# Footer Grid - Stack to Grid Pattern #}
        <div class="footer-grid footer-grid-cols-{{ total_columns }}">
            
            {# Brand Column #}
            <div class="footer-brand">
                <div class="footer-brand-identity">
                    <h2 class="footer-brand-name">{{ site_name }}</h2>
                    {% if theme_var('site_tagline') %}
                        <p class="footer-brand-tagline">{{ theme_var('site_tagline') }}</p>
                    {% endif %}
                </div>
                
                {# Contact Information #}
                {% if has_contact %}
                    <address class="footer-contact">
                        {% if theme_var('contact_phone') %}
                            <a href="tel:{{ theme_var('contact_phone')|replace({' ': '', '(': '', ')': '', '-': ''}) }}" 
                               class="footer-contact-item">
                                <span class="footer-contact-icon">
                                    <i class="la la-phone" aria-hidden="true"></i>
                                </span>
                                <span>{{ theme_var('contact_phone') }}</span>
                            </a>
                        {% endif %}
                        
                        {% if theme_var('social_email') %}
                            <a href="mailto:{{ theme_var('social_email') }}" 
                               class="footer-contact-item">
                                <span class="footer-contact-icon">
                                    <i class="la la-envelope" aria-hidden="true"></i>
                                </span>
                                <span class="break-all">{{ theme_var('social_email') }}</span>
                            </a>
                        {% endif %}
                        
                        {% if theme_var('contact_address') %}
                            <div class="footer-contact-item">
                                <span class="footer-contact-icon">
                                    <i class="la la-map-marker" aria-hidden="true"></i>
                                </span>
                                <span class="not-italic">{{ theme_var('contact_address')|nl2br }}</span>
                            </div>
                        {% endif %}
                    </address>
                {% endif %}
            </div>
            
            {# Footer Navigation Columns #}
            {% if footer_columns %}
                {% for column in footer_columns %}
                    <nav class="footer-nav" aria-labelledby="footer-nav-{{ loop.index }}">
                        <button type="button"
                                class="footer-nav-toggle"
                                aria-expanded="false"
                                aria-controls="footer-nav-content-{{ loop.index }}"
                                data-footer-toggle>
                            <h3 id="footer-nav-{{ loop.index }}" class="footer-nav-title">
                                {{ column.title }}
                            </h3>
                            <i class="la la-angle-down footer-nav-icon" aria-hidden="true"></i>
                        </button>
                        
                        <div id="footer-nav-content-{{ loop.index }}"
                             class="footer-nav-content"
                             aria-hidden="true">
                            {% if column.links %}
                                <ul class="footer-nav-list" role="list">
                                    {% for link in column.links %}
                                        <li>
                                            <a href="{{ link.url }}" class="footer-nav-link">
                                                <i class="la la-angle-{{ direction == 'rtl' ? 'left' : 'right' }}" aria-hidden="true"></i>
                                                <span>{{ link.text }}</span>
                                            </a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    </nav>
                {% endfor %}
            {% endif %}
            
        </div>
    </div>

    {# Sub-Footer #}
    <div class="footer-sub">
        <div class="footer-sub-content">
            <div class="footer-copyright">
                {% if copyright %}
                    {{ copyright|raw }}
                {% else %}
                    <p>&copy; {{ "now"|date("Y") }} {{ site_name }}. All rights reserved.</p>
                {% endif %}
            </div>
            
            <div class="footer-credits">
                <span>Powered by</span>
                <a href="https://getgrav.org" target="_blank" rel="noopener noreferrer">Grav</a>
                <span>â€¢</span>
                <a href="https://github.com/syedaalin/grav-theme-nur-ul-huda" target="_blank" rel="noopener noreferrer">Nur-ul-Huda Theme</a>
            </div>
        </div>
    </div>
    
    {# Back to Top Button #}
    <a href="#top" class="footer-back-to-top" aria-label="Back to top" data-back-to-top>
        <i class="la la-angle-up" aria-hidden="true"></i>
    </a>
</footer>

<style>
/* Footer CSS Variables - 2026 Modern Standard (OKLCH) */
:root {
    /* Deep Navy/Black independent of SRGB */
    --footer-bg-from: oklch(0.15 0.02 260);
    --footer-bg-via: oklch(0.20 0.03 260);
    --footer-bg-to: oklch(0.15 0.02 260);
    --footer-text: oklch(0.85 0.02 260);
    --footer-text-muted: oklch(0.70 0.02 260);
    --footer-border: oklch(0.30 0.03 260 / 0.5);
    --footer-sub-bg: oklch(0.12 0.02 260 / 0.5);
    --footer-icon-bg: oklch(0.25 0.03 260 / 0.5);
    --footer-icon-bg-hover: oklch(0.65 0.22 260 / 0.2);
    --footer-social-bg: oklch(0.25 0.03 260 / 0.8);
    --footer-transition: 300ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* Main Footer */
.footer {
    position: relative;
    overflow: hidden;
    background: linear-gradient(to bottom right, var(--footer-bg-from), var(--footer-bg-via), var(--footer-bg-to));
    color: var(--footer-text);
}

/* Background Pattern */
.footer-pattern {
    position: absolute;
    inset: 0;
    opacity: 0.05;
    pointer-events: none;
}

/* Main Content Container - The "Container" for Queries */
.footer-main {
    position: relative;
    container-type: inline-size;
    max-width: 1280px;
    margin: 0 auto;
    /* Fluid Padding using clamp() */
    padding: clamp(3rem, 5cqw + 2rem, 5rem) clamp(1rem, 4cqw, 3rem);
}

/* Social Media Section */
.footer-social {
    margin-bottom: clamp(2rem, 4cqw, 3.5rem);
    text-align: center;
}

@container (min-width: 768px) {
    .footer-social {
        text-align: left;
    }
}

.footer-social-title {
    color: white;
    font-weight: 700;
    font-size: clamp(1.125rem, 2cqw + 0.5rem, 1.35rem);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 1rem;
}

.footer-social-icons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: clamp(0.75rem, 1cqw, 1.25rem);
}

@container (min-width: 768px) {
    .footer-social-icons {
        justify-content: flex-start;
    }
}

.footer-social-icon {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: clamp(3rem, 4cqw, 3.75rem);
    height: clamp(3rem, 4cqw, 3.75rem);
    border-radius: 9999px;
    background: var(--footer-social-bg);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    transition: all var(--footer-transition);
    will-change: transform;
}

.footer-social-icon:hover {
    background: var(--color-primary);
    transform: scale(1.1);
    box-shadow: 0 10px 15px -3px rgba(var(--color-primary-rgb), 0.3);
}

.footer-social-icon:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 4px;
}

.footer-social-icon i {
    font-size: clamp(1.25rem, 1.5cqw, 1.6rem);
    transition: transform var(--footer-transition);
}

.footer-social-icon:hover i {
    transform: scale(1.1);
}

/* Footer Grid - Intrinsic Grid Layout */
.footer-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: clamp(2rem, 4cqw, 4rem);
}

@container (min-width: 768px) {
    .footer-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@container (min-width: 1024px) {
    .footer-grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
    .footer-grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
    .footer-grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
}

/* Brand Column */
.footer-brand {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.footer-brand-identity {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.footer-brand-name {
    color: white;
    font-weight: 700;
    /* Fluid Typography */
    font-size: clamp(1.5rem, 5cqw + 0.5rem, 2.25rem);
    line-height: 1.1;
    letter-spacing: -0.025em;
}

.footer-brand-tagline {
    font-size: clamp(1rem, 1.2cqw, 1.15rem);
    color: var(--footer-text-muted);
    line-height: 1.6;
    max-width: 20rem;
}

/* Contact Information */
.footer-contact {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    font-style: normal;
}

.footer-contact-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0;
    min-height: 44px;
    font-size: 1rem;
    font-weight: 500;
    color: var(--footer-text);
    transition: color var(--footer-transition);
}

.footer-contact-item:hover {
    color: var(--color-primary);
}

.footer-contact-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    width: 2.75rem;
    height: 2.75rem;
    border-radius: 0.5rem;
    background: var(--footer-icon-bg);
    transition: background var(--footer-transition);
}

.footer-contact-item:hover .footer-contact-icon {
    background: var(--footer-icon-bg-hover);
}

.footer-contact-icon i {
    font-size: 1.25rem;
}

/* Navigation Columns */
.footer-nav-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 0.75rem 0;
    min-height: 44px;
    text-align: left;
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
}

@container (min-width: 768px) {
    .footer-nav-toggle {
        pointer-events: none;
        cursor: default;
    }
}

.footer-nav-title {
    color: white;
    font-weight: 700;
    font-size: clamp(1rem, 1.5cqw, 1.15rem);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.footer-nav-icon {
    font-size: 1.25rem;
    color: var(--footer-text-muted);
    transition: transform var(--footer-transition);
}

@container (min-width: 768px) {
    .footer-nav-icon {
        display: none;
    }
}

.footer-nav-toggle[aria-expanded="true"] .footer-nav-icon {
    transform: rotate(180deg);
}

/* Navigation Content */
.footer-nav-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

@container (min-width: 768px) {
    .footer-nav-content {
        display: block !important;
        max-height: none !important;
    }
}

.footer-nav-content.active {
    display: block !important;
    max-height: 500px;
    transition: max-height 0.4s ease-in;
}

.footer-nav-list {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    margin-top: 1rem;
    list-style: none;
    padding: 0;
}

.footer-nav-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 0;
    min-height: 44px;
    font-size: 1rem;
    color: var(--footer-text-muted);
    transition: all var(--footer-transition);
}

.footer-nav-link:hover {
    color: var(--color-primary);
}

.footer-nav-link i {
    font-size: 0.875rem;
    opacity: 0;
    transition: opacity var(--footer-transition);
}

.footer-nav-link:hover i {
    opacity: 1;
}

.footer-nav-link span {
    transition: transform var(--footer-transition);
}

.footer-nav-link:hover span {
    transform: translateX(0.25rem);
}

/* Sub-Footer */
.footer-sub {
    position: relative;
    border-top: 1px solid var(--footer-border);
    background: var(--footer-sub-bg);
}

.footer-sub-content {
    max-width: 1280px;
    margin: 0 auto;
    padding: clamp(1.5rem, 3cqw, 2rem) clamp(1rem, 3cqw, 2rem);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    text-align: center;
    content-visibility: auto; /* Performance Optimization */
}

@media (min-width: 768px) {
    .footer-sub-content {
        flex-direction: row;
        justify-content: space-between;
        text-align: left;
    }
}

.footer-copyright {
    font-size: clamp(0.875rem, 1cqw, 1rem);
    color: var(--footer-text-muted);
}

.footer-credits {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    font-size: clamp(0.875rem, 1cqw, 1rem);
    color: oklch(0.60 0.02 260);
}

@media (min-width: 768px) {
    .footer-credits {
        justify-content: flex-end;
    }
}

.footer-credits a {
    font-weight: 500;
    color: var(--footer-text-muted);
    text-decoration: none;
    text-underline-offset: 2px;
    transition: color var(--footer-transition);
}

.footer-credits a:hover {
    color: var(--color-primary);
    text-decoration: underline;
}

/* Back to Top Button */
.footer-back-to-top {
    position: fixed;
    bottom: 1.5rem;
    right: 1.5rem;
    z-index: 40;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 3rem;
    height: 3rem;
    border-radius: 9999px;
    background: var(--color-primary);
    color: white;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
    opacity: 0;
    pointer-events: none;
    transition: all var(--footer-transition);
    will-change: transform, opacity;
}

@media (min-width: 640px) {
    .footer-back-to-top {
        width: 3.5rem;
        height: 3.5rem;
    }
}

.footer-back-to-top.visible {
    opacity: 1;
    pointer-events: auto;
}

.footer-back-to-top:hover {
    transform: scale(1.1);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4);
}

.footer-back-to-top:focus-visible {
    outline: 2px solid white;
    outline-offset: 4px;
}

.footer-back-to-top i {
    font-size: 1.5rem;
}

/* RTL Support */
[dir="rtl"] .footer-back-to-top {
    right: auto;
    left: 1.5rem;
}

/* Smooth Scroll */
html {
    scroll-behavior: smooth;
}

/* Focus States */
footer a:focus-visible,
footer button:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 4px;
    border-radius: 4px;
}
</style>

<script>
// Enhanced Footer JavaScript - Performance Optimized
(function() {
    'use strict';
    
    // Cache DOM elements
    const footer = document.getElementById('footer');
    if (!footer) return;
    
    const backToTop = footer.querySelector('[data-back-to-top]');
    const accordionToggles = footer.querySelectorAll('[data-footer-toggle]');
    
    // Accordion Functionality with Event Delegation (Mobile Only)
    if (accordionToggles.length > 0) {
        const isMobile = () => window.innerWidth < 768;
        
        // Single event listener for all toggles (event delegation pattern)
        footer.addEventListener('click', function(e) {
            const toggle = e.target.closest('[data-footer-toggle]');
            if (!toggle || !isMobile()) return;
            
            const content = toggle.nextElementSibling;
            const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
            
            // Toggle accordion
            toggle.setAttribute('aria-expanded', !isExpanded);
            content.setAttribute('aria-hidden', isExpanded);
            content.classList.toggle('active');
        });
        
        // Reset accordions on resize (debounced)
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                if (!isMobile()) {
                    accordionToggles.forEach(toggle => {
                        toggle.setAttribute('aria-expanded', 'false');
                        const content = toggle.nextElementSibling;
                        content.setAttribute('aria-hidden', 'false');
                        content.classList.remove('active');
                    });
                }
            }, 150);
        }, { passive: true });
    }
    
    // Back to Top Button with IntersectionObserver (More Efficient)
    if (backToTop) {
        // Fallback to scroll listener if IntersectionObserver not supported
        if ('IntersectionObserver' in window) {
            // Create a sentinel element at 300px from top
            const sentinel = document.createElement('div');
            sentinel.style.cssText = 'position:absolute;top:300px;height:1px;width:1px;pointer-events:none;';
            document.body.prepend(sentinel);
            
            const observer = new IntersectionObserver(
                ([entry]) => {
                    backToTop.classList.toggle('visible', !entry.isIntersecting);
                },
                { threshold: 0 }
            );
            
            observer.observe(sentinel);
        } else {
            // Fallback: scroll listener with debouncing
            let scrollTimeout;
            window.addEventListener('scroll', function() {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(function() {
                    backToTop.classList.toggle('visible', window.scrollY > 300);
                }, 100);
            }, { passive: true });
        }
    }
})();
</script>
