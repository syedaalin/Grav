<section class="section section-py modular-khums-calculator bg-surface-subtle @container">
    <div class="container-px mx-auto">
        <div class="max-w-5xl mx-auto">
            
            <div class="text-center mb-16 animate-fade-in-up">
                <h2 class="section-title mb-4">{{ page.header.calc_title|default('Khums & Sadaqah Calculator') }}</h2>
                <p class="text-base @lg:text-lg text-subtle max-w-2xl mx-auto">{{ page.header.calc_description|default('Calculate your religious dues with complete privacy. All calculations are performed client-side.') }}</p>
                
                {# Hidden config data for JS #}
                <div id="khums-currency-config" data-currency="{{ page.header.currency_symbol|default('$') }}" hidden aria-hidden="true"></div>
                <div id="khums-rate-config" data-rate="{{ page.header.khums_rate|default(20) }}" hidden aria-hidden="true"></div>
            </div>

            <div class="grid grid-cols-1 @lg:grid-cols-3 gap-8">
                
                {# Inputs Area #}
                <div class="col-span-1 @lg:col-span-2 space-y-6">
                    <fieldset class="card-glass p-8 group/field">
                        <legend class="text-xl font-bold mb-8 flex items-center gap-3 text-gray-900">
                            <i class="la la-coins text-primary" aria-hidden="true"></i> 1. Assets (Surplus)
                        </legend>
                        
                        <div class="grid grid-cols-1 @md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label for="khums-savings" class="text-xs font-black uppercase tracking-[0.2em] text-subtle">Savings & Cash</label>
                                <div class="relative">
                                    <span class="absolute start-4 top-1/2 -translate-y-1/2 font-bold text-subtle" aria-hidden="true">{{ page.header.currency_symbol|default('$') }}</span>
                                    <input type="number" id="khums-savings" class="w-full bg-white/50 border border-subtle rounded-2xl py-4 ps-10 pe-4 focus:input-focus active-assets" value="0">
                                </div>
                            </div>
                            
                            <div class="space-y-2">
                                <label for="khums-gold" class="text-xs font-bold uppercase tracking-wider text-subtle">Gold & Jewelry</label>
                                <div class="relative">
                                    <span class="absolute start-4 top-1/2 -translate-y-1/2 font-bold text-subtle" aria-hidden="true">{{ page.header.currency_symbol|default('$') }}</span>
                                    <input type="number" id="khums-gold" class="w-full bg-white/50 border border-subtle rounded-2xl py-4 ps-10 pe-4 focus:input-focus active-assets" value="0">
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label for="khums-business" class="text-xs font-bold uppercase tracking-wider text-subtle">Business Inventory</label>
                                <div class="relative">
                                    <span class="absolute start-4 top-1/2 -translate-y-1/2 font-bold text-subtle" aria-hidden="true">{{ page.header.currency_symbol|default('$') }}</span>
                                    <input type="number" id="khums-business" class="w-full bg-white/50 border border-subtle rounded-2xl py-4 ps-10 pe-4 focus:input-focus active-assets" value="0">
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label for="khums-other" class="text-xs font-bold uppercase tracking-wider text-subtle">Other Surplus Assets</label>
                                <div class="relative">
                                    <span class="absolute start-4 top-1/2 -translate-y-1/2 font-bold text-subtle" aria-hidden="true">{{ page.header.currency_symbol|default('$') }}</span>
                                    <input type="number" id="khums-other" class="w-full bg-white/50 border border-subtle rounded-2xl py-4 ps-10 pe-4 focus:input-focus active-assets" value="0">
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="card-glass p-8 group/field">
                        <legend class="text-xl font-bold mb-8 flex items-center gap-3 text-gray-900">
                            <i class="la la-hand-holding-usd text-accent" aria-hidden="true"></i> 2. Deductible Liabilities
                        </legend>
                        <div class="space-y-2">
                            <label for="khums-debts" class="text-xs font-bold uppercase tracking-wider text-subtle">Outstanding Debts & Expenses</label>
                                <div class="relative">
                                    <span class="absolute start-4 top-1/2 -translate-y-1/2 font-bold text-subtle" aria-hidden="true">{{ page.header.currency_symbol|default('$') }}</span>
                                    <input type="number" id="khums-debts" class="w-full bg-white/50 border border-subtle rounded-2xl py-4 ps-10 pe-4 focus:input-focus active-assets" value="0">
                                </div>
                        </div>
                    </fieldset>
                </div>

                {# Results Area #}
                <div class="col-span-1">
                    <div class="card-glass p-8 sticky top-24">
                        <h3 class="text-xl font-bold mb-6 text-gray-900">Summary</h3>
                        
                        <div class="space-y-4 mb-8">
                            <div class="flex justify-between text-sm">
                                <span class="text-subtle">Total Net Surplus:</span>
                                <span id="khums-net-display" class="font-black text-gray-950 tabular-nums">{{ page.header.currency_symbol|default('$') }} 0.00</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-subtle">Khums Rate:</span>
                                <span class="font-bold text-gray-900">{{ page.header.khums_rate|default(20) }}%</span>
                            </div>
                        </div>

                        <div class="bg-white/90 backdrop-blur rounded-2xl p-6 mb-8 text-center border border-subtle shadow-inner-premium-premium">
                            <div class="text-[10px] font-black uppercase tracking-[0.2em] text-primary mb-2">Total Khums Due</div>
                            <div id="khums-total-display" class="text-3xl @md:text-4xl font-black text-gray-950 tabular-nums">{{ page.header.currency_symbol|default('$') }} 0.00</div>
                        </div>

                        {# Khums Split Toggle #}
                        <div class="mb-8 p-4 bg-white/40 rounded-2xl border border-subtle">
                             <label class="flex items-center justify-between cursor-pointer group">
                                <span class="text-xs font-bold text-gray-700 uppercase tracking-tight">Split 50/50 (Imam/Sadaat)</span>
                                <input type="checkbox" id="khums-split-toggle" class="sr-only peer">
                                <div class="relative w-11 h-6 bg-subtle peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                            </label>
                            <p class="text-[10px] text-subtle mt-2 leading-tight">Divide your contribution equally between Sehme Imam and Sehme Sadaat.</p>
                        </div>

                        <div class="space-y-3">
                            <div class="flex items-center gap-2 p-3 rounded-xl bg-green-50 text-[10px] text-green-700 font-bold uppercase tracking-wider mb-4 border border-green-100">
                                <i class="la la-shield-alt" aria-hidden="true"></i> Secure & Client-Side Only
                            </div>
                            
                            <button id="khums-checkout-btn" 
                                class="btn-primary w-full py-5 snipcart-add-item"
                                data-item-id="{{ page.header.donation_snipcart_id|default('khums-donation') }}"
                                data-item-name="Khums Donation"
                                data-item-price="0"
                                data-item-url="{{ page.url(true) }}"
                                data-item-custom1-name="Donation Type"
                                data-item-custom1-options="Full Amount|Split 50/50"
                                data-item-custom2-name="Sehme Imam"
                                data-item-custom2-type="hidden"
                                data-item-custom3-name="Sehme Sadaat"
                                data-item-custom3-type="hidden">
                                <i class="la la-heart mr-2" aria-hidden="true"></i> Pay Khums
                            </button>
                            
                            <button id="sadaqah-toggle-btn" class="w-full border-2 border-primary/20 text-primary py-3 rounded-2xl font-black hover:bg-primary/5 transition-all text-[10px] uppercase tracking-widest">
                                Add Optional Sadaqah
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</section>

