<div class="footer-builder-row">
    {% set widgets = theme_var('agent_footer_widgets') %}
    
    {# Default Footer if Builder is Empty #}
    {% if not widgets %}
       {# Render Standard Columns (Fallback) #}
        <div class="footer-col col-4">
            <h3 class="footer-heading">{{ site.title }}</h3>
            <p class="footer-tagline">{{ site.metadata.description }}</p>
            {# Social Icons removed from default fallback - only available via Builder #}
            {# {% include 'partials/social-icons.html.twig' ignore missing %} #}
        </div>
        {# Contact Section removed from default fallback - only available via Builder #}
        {#
        <div class="footer-col col-4">
            <h3 class="footer-heading">Contact</h3>
            <ul class="contact-list">
                 <li><a href="mailto:{{ theme_var('contact_email') }}">{{ theme_var('contact_email') }}</a></li>
            </ul>
        </div> 
        #}
         <div class="footer-col col-4">
            <h3 class="footer-heading">{{ theme_var('agent_footer_links_title')|default('Links'|t) }}</h3>
         </div>
    
    {% else %}
        
        {# Dynamic Builder Loop #}
        {% for widget in widgets %}
            {# Responsive Classes Calculation #}
            {% set w_mobile = widget.width_mobile|default('col-sm-12') %}
            {% set w_tablet = widget.width_tablet|default('col-md-6') %}
            {% set w_desktop = widget.width_desktop|default(widget.width)|default('col-4') %}
            
            {% set anim_attr = widget.animation and widget.animation != 'none' ? 'data-aos="' ~ widget.animation ~ '"' : '' %}
            {% set ai_badge = widget.ai_badge ? '<span class="ai-badge" title="Content generated by AI">AI</span>' : '' %}

            <div class="footer-col {{ w_mobile }} {{ w_tablet }} {{ w_desktop }} widget-type-{{ widget.type }}" {{ anim_attr|raw }}>
                {% if widget.title %}
                    <h3 class="footer-heading">{{ widget.title }}</h3>
                {% endif %}
                
                <div class="widget-content">
                    {# Inject AI Badge if enabled #}
                    {% if widget.ai_badge %}{{ ai_badge|raw }}{% endif %}
                    {% if widget.type == 'branding' %}
                         <div class="footer-branding">
                             {% set logo_file = theme_var('agent_identity_logo') ? theme_var('agent_identity_logo')|first.name : 'logo.png' %}
                             <img src="{{ url('theme://images/logo/' ~ logo_file) }}" alt="Logo" class="footer-logo" style="height: {{ widget.logo_height|default(40) }}px; margin-bottom: 1rem;">
                             <p>{{ widget.content|default(site.metadata.description)|raw }}</p>
                         </div>
                    
                    {% elseif widget.type == 'menu' %}
                        {# Simplify menu rendering for footer #}
                         <ul class="footer-menu">
                            {% for page in pages.children.visible %}
                                <li><a href="{{ page.url }}">{{ page.menu }}</a></li>
                            {% endfor %}
                        </ul>

                         <ul class="contact-list">
                            {% if theme_var('agent_identity_address') %}
                            <li><span class="icon">üìç</span> {{ theme_var('agent_identity_address') }}</li>
                            {% endif %}
                            {% if theme_var('agent_identity_email') %}
                            <li><span class="icon">‚úâÔ∏è</span> <a href="mailto:{{ theme_var('agent_identity_email') }}">{{ theme_var('agent_identity_email') }}</a></li>
                            {% endif %}
                            {% if theme_var('agent_identity_phone') %}
                            <li><span class="icon">üìû</span> <a href="tel:{{ theme_var('agent_identity_phone') }}">{{ theme_var('agent_identity_phone') }}</a></li>
                            {% endif %}
                        </ul>

                    {% elseif widget.type == 'social' %}
                        <div class="social-section">
                             <div class="social-icons icons-only">
                                {% for item in theme_var('agent_identity_social') %}
                                    <a href="{{ item.url }}" target="_blank" class="social-btn"><i class="fa fa-{{ item.network }}"></i></a>
                                {% endfor %}
                             </div>
                        </div>

                    {% elseif widget.type == 'newsletter' %}
                         <p>{{ widget.content|default('Subscribe to our newsletter.') }}</p>
                         <form class="footer-form" action="#">
                            <input type="email" placeholder="Email Address" required>
                            <button type="submit">Subscribe</button>
                        </form>

                    {% elseif widget.type == 'html' %}
                        {{ widget.content|raw }}
                    {% endif %}
                </div>
            </div>
        {% endfor %}
        
    {% endif %}
</div>
