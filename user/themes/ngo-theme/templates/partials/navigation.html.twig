{% import 'macros/macros.html.twig' as macros %}

<ul class="flex flex-col @lg:flex-row @lg:items-center gap-6 @lg:gap-12 {{ tree ? 'pl-4 border-l-2 border-brand-primary/10 space-y-4 @lg:pl-0 @lg:border-l-0 @lg:space-y-0' : '' }}" role="list">
    {% if theme_config.mega_menu_structure %}
        {# Custom Mega Menu / Manual Config #}
        {% for col in theme_config.mega_menu_structure %}
            <li class="group/nav relative">
                <a href="#" class="flex items-center px-4 py-4 @lg:px-8 @lg:py-4 text-sm @lg:text-[13px] font-black transition-all rounded-xl @lg:rounded-[1.5rem] uppercase tracking-wider @lg:tracking-[0.15em] text-brand-dark/60 @lg:text-brand-dark/40 hover:text-brand-primary hover:bg-brand-primary/5 min-h-[44px]" aria-haspopup="true">
                    {{ col.title }}
                    <span class="la la-angle-down ml-3 text-xs transition-transform duration-500 group-hover/nav:rotate-180" aria-hidden="true"></span>
                </a>
                <ul class="@lg:absolute @lg:top-full @lg:left-0 @lg:min-w-[300px] @lg:bg-white/40 @lg:backdrop-blur-3xl @lg:shadow-4xl @lg:rounded-[2.5rem] @lg:p-8 @lg:mt-6 @lg:opacity-0 @lg:invisible @lg:group-hover/nav:opacity-100 @lg:group-hover/nav:visible @lg:translate-x-4 @lg:group-hover/nav:translate-x-0 @lg:transition-all @lg:duration-700 @lg:z-[70] @lg:border @lg:border-brand-primary/10 pl-10 border-l-2 border-brand-primary/5 ml-8 space-y-4 mt-6 @lg:ml-0 @lg:border-l-0" role="list">
                    {% for link in col.links %}
                        <li>
                            <a href="{{ link.url }}" class="block text-sm font-bold text-brand-gray hover:text-brand-primary transition-colors py-2">
                                {{ link.text }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </li>
        {% endfor %}
    {% else %}
        {# Default Grav Page Hierarchy #}
        {{ macros.nav_loop(pages) }}
    {% endif %}
    
    {# Call to Action Button & User Action Area #}
    {% set cta_button = theme_config.cta_button %}
    <li class="flex flex-col @lg:flex-row items-center gap-4 mt-10 @lg:mt-0 @lg:ml-4">
        {% if cta_button.enabled|default(true) %}
            <a href="{{ cta_button.url|default('https://moodle.aabtaab.com') }}" 
               class="group/cta inline-flex items-center gap-4 px-10 py-4 bg-gradient-to-br from-brand-primary to-brand-secondary text-white text-[11px] font-black uppercase tracking-[0.2em] rounded-[1.5rem] hover:scale-105 active:scale-95 transition-all shadow-3xl shadow-brand-primary/30 justify-center" 
               {% if cta_button.external|default(true) %}target="_blank" rel="noopener noreferrer"{% endif %}>
                <span class="la la-{{ cta_button.icon|default('user-graduate') }} text-2xl transition-transform duration-500 group-hover/cta:-translate-y-1" aria-hidden="true"></span> 
                <span>{{ cta_button.text|default('Student Portal') }}</span>
            </a>
        {% endif %}

        {# User Dashboard / SSO Button (2026 standard) #}
        <a href="/dashboard" class="group/user p-3 bg-surface-sunken hover:bg-brand-primary/10 rounded-full transition-all" title="My Dashboard (SSO)">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-brand-dark group-hover/user:text-brand-primary"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        </a>
    </li>
    
    {# AI Search Bar Component #}
    <li class="hidden @lg:block ml-4">
        <button class="w-11 h-11 rounded-full bg-brand-primary/5 hover:bg-brand-primary hover:text-white flex items-center justify-center transition-all shadow-sm hover:shadow-lg group/search" aria-label="Open AI Search" title="Ask AI Assistant">
            <span class="la la-search group-hover/search:scale-110 transition-transform font-bold"></span>
        </button>
    </li>

    {# Global Interaction Toggles #}
    <li class="flex items-center gap-3 mt-10 @lg:mt-0 @lg:ml-6 py-10 @lg:py-0 border-t-2 @lg:border-t-0 @lg:border-l-2 border-brand-dark/5 @lg:pl-12">
        <div class="flex items-center gap-2 p-2 bg-white/40 backdrop-blur-3xl rounded-[2.5rem] border border-brand-primary/10 shadow-inner group/controls">
            <button id="dark-toggle" title="Protocol: Nocturnal" aria-label="Toggle Dark Mode" class="p-4 rounded-2xl hover:bg-brand-primary hover:text-white text-brand-dark/30 transition-all group/dark active:scale-90 hover:shadow-2xl hover:shadow-brand-primary/20">
                <span class="la la-moon text-2xl group-hover/dark:rotate-12 transition-transform" aria-hidden="true"></span>
            </button>
            <button id="focus-toggle" title="Protocol: Clarity" aria-label="{{ 'MY_2ND_THEME.ADMIN.FOCUS_MODE'|t }}" class="p-4 rounded-2xl hover:bg-brand-primary hover:text-white text-brand-dark/30 transition-all group/focus active:scale-90 hover:shadow-2xl hover:shadow-brand-primary/20">
                <span class="la la-eye text-2xl group-hover/focus:scale-125 transition-transform" aria-hidden="true"></span>
            </button>
            <button id="eco-toggle" title="Protocol: Sustenance" aria-label="Toggle Eco-Mode" class="p-4 rounded-2xl hover:bg-brand-primary hover:text-white text-brand-dark/30 transition-all group/eco active:scale-90 hover:shadow-2xl hover:shadow-brand-primary/20">
                <span class="la la-leaf text-2xl group-hover/eco:-translate-y-2 transition-transform" aria-hidden="true"></span>
            </button>
        </div>
    </li>
</ul>
