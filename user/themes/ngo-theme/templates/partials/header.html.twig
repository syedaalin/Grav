{% include 'partials/utility-bar.html.twig' %}
<header id="header" class="w-full fixed top-8 z-50 transition-all duration-700 bg-transparent group/header data-[scroll=true]:bg-white/10 data-[scroll=true]:backdrop-blur-3xl data-[scroll=true]:shadow-3xl data-[scroll=true]:shadow-black/5 data-[scroll=true]:border-b data-[scroll=true]:border-white/20 @container" data-scroll="false" role="banner">
    <div class="container mx-auto px-6 max-w-container">
        <nav class="flex items-center justify-between h-header-lg group-data-[scroll=true]/header:h-header-sm transition-all duration-700" aria-label="Main Navigation">
            <div class="shrink-0 transition-transform duration-700 group-data-[scroll=true]/header:scale-90 origin-left">
                {% include 'partials/logo.html.twig' %}
            </div>
            
            <div class="hidden @lg:flex items-center gap-12">
                {% block header_navigation %}
                    {% include 'partials/navigation.html.twig' %}
                {% endblock %}

                {# User Action Area (Rule 3.3) #}
                <div class="flex items-center gap-6 py-3 border-l-2 border-brand-dark/5 pl-8 h-10">
                    {% if config.theme.search_enabled %}
                         <button class="text-2xl hover:text-brand-primary transition-colors focus:outline-none" aria-label="Search">
                            <i class="las la-search"></i>
                        </button>
                    {% endif %}

                    {% if config.theme.education_section %}
                        <a href="{{ config.theme.cta_button.url|default('#') }}" target="_blank" class="hidden @xl:flex items-center gap-2 font-bold text-xs uppercase tracking-widest hover:text-brand-primary transition-colors text-brand-dark">
                            <i class="las la-user-graduate text-lg"></i>
                            <span>{{ config.theme.student_login_title|default('My Dashboard') }}</span>
                        </a>
                    {% endif %}
                    
                    <a href="#" class="relative group/cart text-2xl hover:text-brand-primary transition-colors">
                        <i class="las la-shopping-bag"></i>
                        <span class="absolute -top-1 -right-1 w-4 h-4 bg-brand-secondary text-white text-[9px] font-black rounded-full flex items-center justify-center border-2 border-brand-bg group-hover/cart:scale-110 transition-transform">2</span>
                    </a>
                    
                    {% if config.plugins.login.enabled and grav.user.username %}
                        {% include 'partials/login-status.html.twig' ignore missing %}
                    {% endif %}
                </div>
            </div>
            
            <div class="@lg:hidden flex items-center">
                <button id="toggle" class="group/toggle relative z-[70] p-5 bg-white/10 backdrop-blur-3xl border border-white/20 rounded-[1.5rem] shadow-2xl cursor-pointer focus:outline-none transition-all active:scale-90 hover:shadow-brand-primary/10" aria-label="Toggle Menu" aria-expanded="false" data-state="inactive" popovertarget="overlay">
                    <div class="w-7 h-5 flex flex-col justify-between">
                        <span class="block w-full h-0.5 bg-brand-dark transition-all duration-500 origin-center group-data-[state=active]/toggle:translate-y-2.5 group-data-[state=active]/toggle:rotate-45"></span>
                        <span class="block w-full h-0.5 bg-brand-dark transition-all duration-500 group-data-[state=active]/toggle:opacity-0 group-data-[state=active]/toggle:scale-x-0"></span>
                        <span class="block w-full h-0.5 bg-brand-dark transition-all duration-500 origin-center group-data-[state=active]/toggle:-translate-y-2 group-data-[state=active]/toggle:-rotate-45"></span>
                    </div>
                </button>
            </div>
        </nav>
    </div>
</header>

<div id="overlay" class="fixed inset-0 z-[60] bg-brand-bg/98 backdrop-blur-3xl transform transition-transform duration-700 ease-premium translate-x-full data-[state=open]:translate-x-0 opacity-0 data-[state=open]:opacity-100" aria-hidden="true" data-state="closed" popover>
     <div class="flex flex-col h-full p-6 pt-32 @lg:p-16 @lg:pt-48 max-w-2xl mx-auto overflow-y-auto">
        <nav aria-label="Mobile Navigation">
            {% include 'partials/navigation.html.twig' with {tree: true} %}
        </nav>
     </div>
</div>
