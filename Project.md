---
trigger: always_on
---

them should be globally able to toggle Rtl and Ltr . all components are also follow this rule
Functional Specification: "Nur-e-Hidayat" Grav ThemeVersion: 2.0 | Target Platform: Grav CMS (Flat-File)Scope: Hybrid Religious NGO, E-Commerce, & LMS IntegrationDesign Philosophy: "The Digital Sanctum" (Glassmorphism, Minimalist, 2026 Aesthetics)1. Executive Summary & ArchitectureThis theme is designed to bridge the gap between a spiritual community center and a modern digital service platform. It utilizes a Headless Hybrid architecture:Content Core: Grav CMS (Flat-file markdown for speed/security).Education Engine: Moodle LMS (External, integrated via API).Commerce Engine: Snipcart (Headless JS cart).Frontend Framework: Tailwind CSS + Alpine.js (Lightweight interactivity).2. Theme Configuration (Admin Panel Requirements)The theme configuration panel in the Grav Admin must provide non-technical staff with control over the site's identity and spiritual utility.Tab 1: Visual IdentityBranding: File upload fields for SVG Logo and Favicon.Color Palette: Color pickers for "Primary Spirit Color" (default: Emerald Green) and "Accent Color" (default: Gold).Glassmorphism Control: A slider (0-30px) to control the "blur strength" of UI cards globally.Typography: Dropdown to select font pairings (e.g., "Inter + Noto Nastaliq" for Urdu support).Tab 2: Religious Utilities (The Digital Sanctum)Prayer Calculation Standard: A dropdown to select the mathematical method for prayer times (e.g., University of Tehran, Karachi, ISNA, Leva Institute).Hijri Calibration: A numeric input (+/- 1 or 2 days) to manually adjust the Hijri calendar based on local moon sighting.Adhan Media: File upload for a custom MP3 Adhan file to play at prayer times.Geo-Location Default: Text field for a default city (e.g., "Karachi") if the user denies GPS permissions.Tab 3: IntegrationsMoodle Bridge: Input fields for the Moodle URL and the "Web Service API Token" to fetch course data.Commerce Keys: Input field for the Snipcart Public API Key.Payment Gateways: specific fields for JazzCash/Easypaisa Merchant IDs and Integrity Salts (for Pakistan-based transactions).3. Global Component SpecificationsA. The "Minaret" Utility Bar (Top Header)Date Display: Must show Gregorian date alongside the Hijri date. The Hijri date must dynamically update at Maghrib time (start of the Islamic day).Prayer Countdown: A real-time ticker showing the name of the next prayer and a countdown timer (e.g., "Maghrib in 02:14:15").Accessibility: Toggles for "High Contrast" (B&W mode) and "Text Resize".Language Switcher: Toggle between English, Urdu, Arabic, and Persian.B. The "Sanctum" NavbarLayout: Clean, sticky navigation bar.Smart Menu: Context-aware dropdowns.Education: Links to Moodle courses.Services: Links to Istikhara and Counseling forms.Support: Links to Donation and Khums pages.User Action Area:SSO Button: "My Dashboard" button that authenticates the user into both Grav and Moodle simultaneously.Cart Indicator: Dynamic icon showing item count from Snipcart.4. Modular Page Components (The Homepage Stack)Module 1: The Immersive HeroVisuals: Full-screen background video loop (slow-motion nature or calligraphy) with a frosted glass overlay.Dynamic Content: A "Daily Inspiration" slot that randomly rotates between:Hadith of the Day: Short quote + source.Ayat of the Day: Arabic text + Translation.Nahj al-Balagha: Wisdom from Imam Ali (AS).Call to Actions (CTAs): Two distinct buttonsâ€”one for Services (Business) and one for Donations (NGO).Module 2: Services "Bento Grid"Layout Logic: A masonry-style grid where services can be assigned different visual weights:Standard Box (1x1): Simple links (e.g., "Library").Feature Box (2x2): High-priority services (e.g., "Online Istikhara").Wide Box (2x1): informational items (e.g., "Friday Prayer Times").Interactivity: Hover effects using Glassmorphism (increasing opacity/blur on hover).Module 3: Education Bridge (Moodle Feed)Data Source: Fetches data from the Moodle API (configured in Theme Settings).Display: A horizontal scroll or grid displaying "Featured Courses."Card Data: Course Thumbnail, Title, Instructor Name, and "Enroll Now" button (deep-linked to the specific Moodle enrollment page).Fallback: If the API fails, display a static "Browse Catalog" banner.Module 4: The "Khums & Sadaqah" CalculatorPrivacy Mode: All calculations must happen client-side (JavaScript). No financial data (assets, debts) is sent to the server until the final donation amount is clicked.Inputs: Savings, Gold/Jewelry, Business Inventory, Debts.Logic: Applies the 20% rule to surplus assets.Split Donation: Option to split the payment into "Sehme Imam" and "Sehme Sadaat" with distinct metadata sent to the payment gateway.Module 5: Project Timeline (NGO Transparency)Visuals: A vertical or horizontal progress tracker.Data: Status indicators for ongoing projects (e.g., "Water Well Digging: 75% Funded").Action: "Contribute to this Project" button linked to a specific Snipcart product ID.Module 6: The "Istafta" (Q&A)Format: Accordion-style FAQ for common questions.Submission Form: A secure form for asking new questions.Anonymity: A toggle to "Ask Anonymously," which prevents the storage of IP addresses or user names in the backend submission form.5. Technical & Integration LogicA. Authentication (SSO)Primary Identity Provider: Moodle.Workflow: When a user clicks "Login" on the Grav site, they are redirected to Moodle's login page. Upon success, they are returned to Grav with an OAuth2 token, logging them into the main site automatically.B. E-Commerce (Snipcart + Local Payment)Cart Logic: Snipcart handles the session.Checkout Flow:User adds items/donations.At checkout, if the user is in Pakistan, a custom "Pay with JazzCash" option appears.This triggers a server-side script (PHP) to generate the secure hash required by the JazzCash API.Upon success, JazzCash sends a callback to the site, which then updates the Snipcart order status to "Paid".C. Performance & SEOAsset Strategy:Video Backgrounds: Must use WebM format for compression.Images: Lazy-loading enabled by default.Fonts: Local hosting of "Noto Sans" and "Noto Nastaliq" to avoid Google Font latency and privacy issues.PWA (Progressive Web App): The site must generate a manifest.json and register a Service Worker to allow users to "Install" the website on their mobile home screens and access offline prayer times.D. SecurityCSP (Content Security Policy): Strict policy allowing only specific external domains (Moodle, Snipcart CDN, JazzCash API).Data Minimization: No storage of user location data (GPS) on the server; local storage only.6. Implementation RoadmapPhase 1: Structure: Set up Grav, directory architecture, and Theme YAML configuration.Phase 2: Visuals: Implement Tailwind CSS and the Glassmorphism UI components.Phase 3: Logic: Develop the Prayer Time calculator (JS) and Moodle API fetcher (PHP).Phase 4: Commerce: Integrate Snipcart and build the JazzCash middleware.Phase 5: Content: Populate Modular Pages with Shia-specific content (Hadiths, Services).